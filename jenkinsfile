def vmName = env.NODENAME

            // Verificar si la m치quina virtual ya existe
            def terraformShowOutput = sh(script: "terraform show", returnStdout: true).trim()
            def vmExists = terraformShowOutput.contains("instance-id: ${vmName}")

            if (!vmExists) {
                // La m치quina virtual no existe, crear una nueva
                sh """
                terraform apply \
                    -var='vmname=${vmName}' \
                    -var='poolpath=${POOLPATH}' \
                    -var='remote_iso=${REMOTE_ISO}' \
                    -var='mem=${MEMORY}' \
                    -var='vcpu=${VCPU}' \
                    -var='ssh_username=${SSH_USERNAME}' \
                    -var='password=${SSH_PASSWORD}' \
                    -var='build_id=${BUILD_ID}' \
                    --lock=false \
                    -auto-approve
                """
            } else {
                // La m치quina virtual ya existe, notificar al usuario o simplemente omitir
                echo "La m치quina virtual con el nombre de host ${vmName} ya existe."
            }